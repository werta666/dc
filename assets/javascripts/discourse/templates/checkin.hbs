{{#d-section pageClass="checkin-page" class="checkin-container"}}
  <div class="checkin-header">
    <h1>{{i18n "checkin.title"}}</h1>
    <div class="user-points-summary">
      <div class="points-card">
        <div class="points-value">{{this.userPoint.total_points}}</div>
        <div class="points-label">{{i18n "checkin.total_points"}}</div>
      </div>
      <div class="points-card">
        <div class="points-value">{{this.userPoint.available_points}}</div>
        <div class="points-label">{{i18n "checkin.available_points"}}</div>
      </div>
      <div class="points-card">
        <div class="points-value">{{this.userPoint.consecutive_days}}</div>
        <div class="points-label">{{i18n "checkin.consecutive_days"}}</div>
      </div>
    </div>
  </div>

  <div class="checkin-main">
    <div class="checkin-action-card">
      {{#if this.canCheckinToday}}
        <div class="checkin-button-container">
          <button 
            class="btn btn-primary checkin-button {{if this.isLoading 'loading'}}"
            {{action "performCheckin"}}
            disabled={{this.isLoading}}
          >
            {{#if this.isLoading}}
              {{loading-spinner size="small"}}
            {{else}}
              {{d-icon "calendar-check"}}
              {{i18n "checkin.checkin_today"}}
            {{/if}}
          </button>
          <div class="checkin-reward-info">
            {{i18n "checkin.will_earn_points"
              points=(round (multiply this.checkinSettings.base_points this.consecutiveDaysBonus))
              multiplier=this.consecutiveDaysBonus
            }}
          </div>
        </div>
      {{else}}
        <div class="already-checked-in">
          {{d-icon "check-circle"}}
          <span>{{i18n "checkin.already_checked_in_today"}}</span>
        </div>
      {{/if}}

      {{#if this.nextMilestone}}
        <div class="next-milestone">
          {{i18n "checkin.next_milestone"
            days=this.nextMilestone.days
            bonus=this.nextMilestone.bonus
            remaining=(subtract this.nextMilestone.days this.userPoint.consecutive_days)
          }}
        </div>
      {{/if}}
    </div>

    <div class="makeup-section">
      <h3>{{i18n "checkin.makeup_title"}}</h3>
      <div class="makeup-form">
        <input
          type="date"
          class="makeup-date-input"
          value={{this.selectedMakeupDate}}
          {{on "input" (action "setMakeupDate" value="target.value")}}
        />
        <button 
          class="btn btn-secondary makeup-button {{if this.isLoading 'loading'}}"
          {{action "performMakeup"}}
          disabled={{or this.isLoading (not this.selectedMakeupDate) (not this.canAffordMakeup)}}
        >
          {{#if this.isLoading}}
            {{loading-spinner size="small"}}
          {{else}}
            {{i18n "checkin.makeup_checkin"}}
            ({{this.checkinSettings.makeup_cost}} {{i18n "checkin.points"}})
          {{/if}}
        </button>
      </div>
      {{#unless this.canAffordMakeup}}
        <div class="makeup-warning">
          {{i18n "checkin.insufficient_points_for_makeup"}}
        </div>
      {{/unless}}
    </div>
  </div>

  <div class="recent-records">
    <h3>{{i18n "checkin.recent_records"}}</h3>
    {{#if this.recentRecords}}
      <div class="records-list">
        {{#each this.recentRecords as |record|}}
          <div class="record-item {{if record.is_makeup 'makeup-record'}}">
            <div class="record-date">
              {{record.checkin_date}}
              {{#if record.is_makeup}}
                <span class="makeup-badge">{{i18n "checkin.makeup"}}</span>
              {{/if}}
            </div>
            <div class="record-points">
              +{{record.points_earned}} {{i18n "checkin.points"}}
              {{#if (gt record.bonus_multiplier 1)}}
                <span class="bonus-multiplier">(Ã—{{record.bonus_multiplier}})</span>
              {{/if}}
            </div>
            <div class="record-consecutive">
              {{i18n "checkin.consecutive_days_count" count=record.consecutive_days}}
            </div>
          </div>
        {{/each}}
      </div>
      <div class="view-all-link">
        {{#link-to "points"}}{{i18n "checkin.view_all_records"}}{{/link-to}}
      </div>
    {{else}}
      <div class="no-records">
        {{i18n "checkin.no_records_yet"}}
      </div>
    {{/if}}
  </div>
{{/d-section}}
